---
AWSTemplateFormatVersion: 2010-09-09
Description: >
  RDE API Roles & Policies Stack

Resources:
  RDETEMPLATEPIPELINERole:
    Type: AWS::IAM::Role
    Properties:
      Path: "/"
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
        - Effect: Allow
          Action: sts:AssumeRole
          Principal:
            Service:
            - cloudformation.amazonaws.com
      Policies:
      - PolicyName: "base_policy" 
        PolicyDocument: 
          Version: 2012-10-17
          Statement:
		   - Resource: '*' 
            Effect: Allow
            Action:
            - s3:DeleteObject
            - s3:GetObject
            - s3:GetObjectVersion
            - s3:ListBucket
            - s3:PutObject
            - s3:GetBucketPolicy
          - Resource: '*' #Code Repo Read 
            Effect: Allow
            Action:
            - codecommit:ListBranches
            - codecommit:ListRepositories
            - codecommit:BatchGetRepositories
            - codecommit:Get*
            - codecommit:GitPull
            - codecommit:UploadArchive
            - codebuild:StartBuild
            - codebuild:BatchGetBuilds
            - cloudformation:CreateChangeSet
            - cloudformation:CreateStack
            - cloudformation:DeleteStack
            - cloudformation:Describe*
            - cloudformation:List*
            - cloudformation:UpdateStack
            - cloudformation:ValidateTemplate
            - cloudformation:ExecuteChangeSet
            - iam:PassRole
          - Resource: 'arn:aws:kms:us-east-1:778784494011:key/998de47d-864c-46f2-9a21-48c097978bd'
            Effect: Allow
            Action:
			- kms:Create*
			- kms:Describe*
			- kms:Enable*
			- kms:List*
			- kms:Put*
			- kms:Get* 
			- kms:Update*
			- kms:Encrypt
			- kms:Decrypt
			- kms:ReEncrypt*
			- kms:GenerateDataKey*

Outputs:

  PipelineRole:
    Description: RDE CFN Role ARN
    Value: !Ref RDETEMPLATEPIPELINERole
    Export:
      Name: rde:roles:templates:pipelinerole

